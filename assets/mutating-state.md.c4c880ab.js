import{_ as s,c as a,o as n,N as o}from"./chunks/framework.23a4abfb.js";const e="/proven-pinia-patterns/assets/mutating-state-1.1b46060a.jpg",l="/proven-pinia-patterns/assets/mutating-state-2.7230f8d2.jpg",p="/proven-pinia-patterns/assets/mutating-state-3.35bd5e23.jpg",m=JSON.parse('{"title":"Mutando el Estado","description":"","frontmatter":{},"headers":[],"relativePath":"mutating-state.md"}'),t={name:"mutating-state.md"},c=o(`<h1 id="mutando-el-estado" tabindex="-1">Mutando el Estado <a class="header-anchor" href="#mutando-el-estado" aria-label="Permalink to &quot;Mutando el Estado&quot;">‚Äã</a></h1><p>En la √∫ltima lecci√≥n, vimos c√≥mo podemos acceder al estado desde Pinia y tambi√©n c√≥mo podemos usar <code>v-model</code> para vincular propiedades de estado en una tienda de Pinia. Ahora hablemos de mutaci√≥n de estado.</p><h2 id="mutando-el-estado-1" tabindex="-1">Mutando el Estado <a class="header-anchor" href="#mutando-el-estado-1" aria-label="Permalink to &quot;Mutando el Estado&quot;">‚Äã</a></h2><p>Aqu√≠ es donde Pinia se vuelve un poco... controvertida. Pinia nos permite mutar el estado de varias maneras, permiti√©ndonos decidir d√≥nde y cu√°ndo queremos actualizar el estado en nuestra aplicaci√≥n. Otras bibliotecas de administraci√≥n de estado son mucho m√°s estrictas sobre c√≥mo se cambia el estado.</p><blockquote><p>Por ejemplo, la antigua biblioteca oficial de gesti√≥n de estado de Vue, <a href="https://vuex.vuejs.org/" target="_blank" rel="noreferrer">Vuex</a>, requer√≠a que los cambios de estado se iniciaran mediante el env√≠o de una acci√≥n para cometer una mutaci√≥n; esa era la √∫nica forma de cambiar de estado (a menos que estuviera rompiendo ese patr√≥n en contra de las mejores pr√°cticas recomendadas).</p></blockquote><p>Pinia se ha deshecho de las mutaciones independientes por completo, brind√°ndonos m√°s opciones sobre c√≥mo elegimos mutar el estado.</p><h2 id="mutar-el-estado-de-pinia-con-acciones" tabindex="-1">Mutar el Estado de Pinia con Acciones <a class="header-anchor" href="#mutar-el-estado-de-pinia-con-acciones" aria-label="Permalink to &quot;Mutar el Estado de Pinia con Acciones&quot;">‚Äã</a></h2><blockquote><p>La forma m√°s com√∫n de mutar el estado usando Pinia es desencadenar una acci√≥n en la tienda que haga que se cambie el estado.</p></blockquote><p>En este ejemplo, hacer clic en el bot√≥n <strong>Add to Favorites</strong> activar√° la acci√≥n agregar a favoritos en la tienda de <code>favorites</code>.</p><p><code>üìÑ src/views/RestaurantView.vue</code></p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@click</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">favoritesStore.addToFavorites(singleRestaurant.name)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"> Add to Favorites ‚ù§Ô∏è</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>La acci√≥n <code>addToFavorites</code> publica el favorito en la lista de favoritos del usuario.</p><p><code>üìÑ src/stores/favorites.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineStore</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pinia</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">useAuthStore</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./auth</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> myFetch </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../helpers/myFetch</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> useFavoritesStore </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineStore</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">favorites</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">state</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">userFavorites</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">actions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// This action mutates state by adding a favorite to userFavorites (that happens on the backend so the database is updated)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">addToFavorites</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">restaurant_name</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">authStore</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useAuthStore</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">username</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">authStore</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">username</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        user</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">username</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">restaurant_name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">      </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// The user&#39;s favorite will be added to the database</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">myFetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">favorites</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>Cuando la solicitud de publicaci√≥n llega al punto final en el archivo del servidor, ejecuta m√°s l√≥gica para publicar el favorito en la base de datos (o en este caso, el archivo JSON que creamos para representar una base de datos).</p><p><code>üìÑ /server.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/favorites</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">favorites</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./db/favorites.json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">favorites</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeFileSync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./db/favorites.json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">favorites</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sendStatus</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">400</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><blockquote><p>Este fue un ejemplo de una forma muy com√∫n de mutar el estado mediante el uso de una acci√≥n.</p></blockquote><p>Algunas personas se sorprenden cuando descubren que esta no es la √∫nica forma de cambiar el estado de Pinia. De hecho, he o√≠do hablar de personas que afirman que usar acciones es la √∫nica forma en que podemos mutar el estado en Pinia. ¬°Pero ese no es el caso!</p><h2 id="mutando-el-estado-directamente" tabindex="-1">Mutando el Estado Directamente <a class="header-anchor" href="#mutando-el-estado-directamente" aria-label="Permalink to &quot;Mutando el Estado Directamente&quot;">‚Äã</a></h2><blockquote><p>Tambi√©n podemos cambiar de estado directamente asignando un nuevo valor a la propiedad <code>state</code>.</p></blockquote><p>En el componente <code>Search.vue</code> de nuestra aplicaci√≥n <strong>Pinia Restaurants</strong>, hay un <code>watcher</code> en el valor de <code>city</code> para que, si el usuario elimina la ciudad, borre los datos de b√∫squeda para que pueda iniciar una nueva b√∫squeda.</p><p><code>üìÑ src/components/Search.vue</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> searchChoice</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> restaurantDetails</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">storeToRefs</span><span style="color:#A6ACCD;">(restaurantsStore)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">watch</span><span style="color:#A6ACCD;">(city</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">newVal</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">restaurantDetails</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">searchChoice</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>Se accede a las propiedades <code>restaurantDetails</code> y <code>searchChoice</code> desde la tienda <strong>restaurants</strong> y, como vemos aqu√≠, estas dos propiedades se establecen directamente en un arreglo vac√≠o y una cadena vac√≠a cuando cambia el valor de <code>city</code>. No estamos obligados a mutar estas propiedades de estado a trav√©s de una acci√≥n de Pinia. Podemos mutar directamente el estado aqu√≠ mismo en el componente.</p><h2 id="actualizacion-de-estado-con-patch" tabindex="-1">Actualizaci√≥n de estado con <code>$patch</code> <a class="header-anchor" href="#actualizacion-de-estado-con-patch" aria-label="Permalink to &quot;Actualizaci√≥n de estado con \`$patch\`&quot;">‚Äã</a></h2><blockquote><p>Otra forma en que podemos establecer el estado es usar el m√©todo <code>$patch</code> de Pinia. Este m√©todo nos permite aplicar m√∫ltiples cambios a la vez al estado de la tienda.</p></blockquote><p>Aqu√≠ est√° la misma l√≥gica, pero esta vez usando <code>$patch</code>:</p><p><code>üìÑ src/components/Search.vue</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">watch</span><span style="color:#A6ACCD;">(city</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">newVal</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">restaurantStore</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">$patch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      restaurantDetails</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      searchChoice</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><blockquote><p>Aqu√≠, enviamos un objeto con los cambios que queremos a <code>restaurantDetails</code> y <code>searchChoice</code>.</p></blockquote><p>Si no le gusta la idea de mutar el estado directamente en un componente sin una acci√≥n, puede limitarse a usar solo <code>actions</code> y <code>$patch</code> para realizar cambios en los datos de la tienda.</p><p>Es f√°cil buscar <code>$patch</code> dentro de su c√≥digo o <code>actions</code> por su nombre.</p><p>Pero no olvide que siempre tenemos <strong>devtools</strong> para ayudarnos a rastrear los cambios en el estado, por lo que es posible que no necesitemos ser tan estrictos al agregar un patr√≥n autoimpuesto como ese para la mutaci√≥n del estado.</p><p>Ah, y <code>$patch</code> es especialmente √∫til porque puede tomar un objeto o una funci√≥n como su par√°metro.</p><p>A veces, es posible que necesitemos una l√≥gica m√°s complicada para actualizar el estado, como usar m√©todos de matriz para actualizar una propiedad de estado que es una matriz. Enviar una funci√≥n a trav√©s del m√©todo <code>$patch</code> nos brinda m√°s capacidad para hacer una l√≥gica compleja para mutar el estado.</p><p>Ejemplo:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">restaurantsStore</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">$patch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">state</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">state</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">restaurantDetails</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">splice</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">state</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">restaurantDetails</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">state</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">searchChoice</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h2 id="restablecer-estado-con-reset" tabindex="-1">Restablecer estado con <code>$reset</code> <a class="header-anchor" href="#restablecer-estado-con-reset" aria-label="Permalink to &quot;Restablecer estado con \`$reset\`&quot;">‚Äã</a></h2><blockquote><p>Convenientemente, Pinia tambi√©n ofrece un m√©todo <code>$reset</code> para que podamos restablecer el estado completo de una tienda a su valor inicial.</p></blockquote><p>En este ejemplo, el m√©todo <code>$reset</code> se usa dentro de la propia tienda. Dado que este ejemplo es una <strong>Options Store</strong>, podemos acceder al m√©todo <code>$reset</code> usando <code>this</code> para borrar el estado del usuario de la tienda de autenticaci√≥n. Esto restablece al usuario a un objeto vac√≠o.</p><p><code>üìÑ src/stores/auth.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">actions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">logout</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">$reset</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>Tambi√©n podr√≠amos usar <code>$reset</code> en un componente:</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-if</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">user &amp;&amp; user.username</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@click</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">authStore.$reset()</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  Log Out</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><blockquote><p>Usar una funci√≥n de reinicio como esta es realmente √∫til si necesitamos actualizar una tienda completa a la vez, como cuando el usuario navega a una p√°gina determinada.</p></blockquote><p>Eche un vistazo a este ejemplo en el que usamos el m√©todo de reinicio de Pinia en el enrutador.</p><p><code>üìÑ src/router/index.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">beforeEach</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">to</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">restaurantsStore</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useRestaurantsStore</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">to</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">home</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">restaurantsStore</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">$reset</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>S√≠, podemos acceder al estado de Pinia en un archivo de enrutador. Aqu√≠, si quisi√©ramos restablecer toda la informaci√≥n de <strong>restaurant</strong>, borrando una b√∫squeda anterior cuando un usuario navega de regreso a la p√°gina de inicio, podemos llamar a la funci√≥n <code>$reset</code> cada vez que alguien navega de regreso a la p√°gina de inicio.</p><h2 id="una-limitacion-de-los-setup-stores" tabindex="-1">Una limitaci√≥n de los Setup Stores <a class="header-anchor" href="#una-limitacion-de-los-setup-stores" aria-label="Permalink to &quot;Una limitaci√≥n de los Setup Stores&quot;">‚Äã</a></h2><blockquote><p>Desafortunadamente, el m√©todo <code>$reset</code> no est√° disponible si usamos un <strong>setup store</strong>.</p></blockquote><p>¬°Aqu√≠ hay un ejemplo en el que las *<strong>options store</strong> tienen una ventaja sobre las <strong>setup store</strong>!</p><p>Esto se debe a que el m√©todo <code>$reset</code> se basa en la funci√≥n <code>state()</code> para crear un nuevo estado, reemplazando el <code>store.$state</code> actual por uno nuevo. Como no tenemos esa funci√≥n <code>state()</code> en una <strong>setup store</strong>, Pinia no tiene forma de hacer esto.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// We have a state function in options stores</span></span>
<span class="line"><span style="color:#FFCB6B;">state</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">userFavorites</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><blockquote><p>Sin embargo, esta podr√≠a ser una buena oportunidad para crear un complemento de Pinia (hablaremos m√°s sobre eso en la <a href="./pinia-plugins.html">pr√≥xima lecci√≥n</a>).</p></blockquote><p>Otra posibilidad ser√≠a simplemente crear nuestro propio m√©todo de reinicio para una tienda individual.</p><p>For example, we could create an Action that serves the purpose of resetting our entire store. Here‚Äôs how that could look, with a resetRestaurantsStore action to clear out each state property in the restaurants store, resetting the store to its original state. We would only need to use this if our store is a setup store and we‚Äôre needing a function to reset the entire state.</p><p>Por ejemplo, podr√≠amos crear una Acci√≥n que sirva para restablecer toda nuestra tienda. As√≠ es como podr√≠a verse, con una acci√≥n <code>resetRestaurantsStore</code> para borrar cada propiedad de estado en la tienda <strong>restaurant</strong>, restableciendo la tienda a su estado original. Solo necesitar√≠amos usar esto si nuestra tienda es una <strong>setup store</strong> y necesitamos una funci√≥n para restablecer todo el estado.</p><p><code>üìÑ src/stores/restaurants.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//action in a setup store</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">resetRestaurantsStore</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">searchChoice</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">restaurantDetails</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">singleRestaurant</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">textSearchResults</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">loading</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="claridad-a-traves-de-devtools" tabindex="-1">Claridad a trav√©s de Devtools <a class="header-anchor" href="#claridad-a-traves-de-devtools" aria-label="Permalink to &quot;Claridad a trav√©s de Devtools&quot;">‚Äã</a></h2><blockquote><p>Estas son solo algunas de las formas en que podemos acceder y mutar el estado con Pinia. Si bien puede parecer mucho, tenga en cuenta que el soporte de <strong>devtools</strong> es excelente.</p></blockquote><p>Podemos ver cada propiedad de estado y actualizaci√≥n de getter en el panel de herramientas de desarrollo de Pinia, y vemos a qu√© tienda pertenecen.</p><p><img src="`+e+'" alt="mutating-state"></p><p>Y podemos ver cada acci√≥n y parche que ocurre si revisamos el panel de la l√≠nea de tiempo.</p><p><img src="'+l+'" alt="mutating-state"></p><h2 id="onaction" tabindex="-1">$onAction <a class="header-anchor" href="#onaction" aria-label="Permalink to &quot;$onAction&quot;">‚Äã</a></h2><blockquote><p>Mientras terminamos esta lecci√≥n, centr√©monos en una √∫ltima herramienta. Pinia tambi√©n ofrece un m√©todo √∫til que podemos usar para obtener informaci√≥n muy detallada sobre las acciones: el m√©todo <code>$onAction</code>.</p></blockquote><p>Como puede ver, este m√©todo tiene una serie de <strong>hooks</strong> que podemos usar para realizar alguna l√≥gica cuando ocurre una determinada acci√≥n.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">$onAction</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">({</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">store</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">after</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">onError</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">state</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ...</span></span>\n<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>Tenga en cuenta c√≥mo podemos pasar el estado como un segundo argumento, en caso de que lo necesitemos.</p><p>Aqu√≠ se utiliza para registrar informaci√≥n sobre qu√© acci√≥n se ha activado en el <strong>auth store</strong>.</p><p><code>üìÑ src/App.vue</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">authStore</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">$onAction</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">({</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">store</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">Start &quot;</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot; with params [</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">].</span><span style="color:#89DDFF;">`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>En la consola, cuando el usuario inicia sesi√≥n con el nombre de usuario &#39;srodg&#39; y la contrase√±a &#39;pw&#39;, vemos que est√° registrado. Y vemos que cerrar sesi√≥n no requiere par√°metros.</p><p><img src="'+p+'" alt="mutating-state"></p><p>Pero probablemente rara vez necesitemos usar la consola para registrar esta informaci√≥n, ya que la tenemos toda en las <strong>devtools</strong>.</p><h2 id="a-continuacion" tabindex="-1">A continuaci√≥n ... <a class="header-anchor" href="#a-continuacion" aria-label="Permalink to &quot;A continuaci√≥n ...&quot;">‚Äã</a></h2><p>Estamos casi al final del tutorial, pero tenemos una cosa m√°s de la que hablar: los complementos de Pinia. En la pr√≥xima lecci√≥n, aprenderemos c√≥mo agregar nuestros propios complementos creados por el usuario a Pinia para ayudarnos a hacer a√∫n m√°s.</p>',80),r=[c];function i(y,F,D,d,u,A){return n(),a("div",null,r)}const h=s(t,[["render",i]]);export{m as __pageData,h as default};
